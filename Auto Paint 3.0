-- Settings --

local color = Color3.fromRGB(255,255,255)

-- Values --

local userInputService = game:GetService("UserInputService")
local runService = game:GetService("RunService")
local tweenService = game:GetService("TweenService")

local player = game.Players.LocalPlayer
local mouse = player:GetMouse()

local provincesFolder = Instance.new("Model")
provincesFolder.Parent = workspace
local highlight = Instance.new("Highlight")
highlight.FillColor = color
highlight.FillTransparency = 0.8
highlight.Parent = workspace
highlight.Adornee = provincesFolder

-- MODERN UI CREATION --
local UI = Instance.new("ScreenGui",player.PlayerGui)
UI.ResetOnSpawn = false
UI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local UIHolder = Instance.new("Frame",UI)
UIHolder.AnchorPoint = Vector2.new(0.5,0.5)
UIHolder.BackgroundTransparency = 1
UIHolder.Position = UDim2.new(0.5,0,0.5,0)
UIHolder.Size = UDim2.new(0,0,0,0)

local mainFrame = Instance.new("Frame",UIHolder)
mainFrame.BackgroundColor3 = Color3.fromRGB(25,25,35)
mainFrame.AnchorPoint = Vector2.new(0.5,0.5)
mainFrame.Position = UDim2.new(0.5,0,0.5,0)
mainFrame.Size = UDim2.new(0,450,0,600)
mainFrame.BorderSizePixel = 0
mainFrame.Rotation = 359

local mainCorner = Instance.new("UICorner",mainFrame)
mainCorner.CornerRadius = UDim.new(0,12)

local topBar = Instance.new("Frame",mainFrame)
topBar.BackgroundColor3 = Color3.fromRGB(35,35,50)
topBar.Size = UDim2.new(1,0,0,50)
topBar.BorderSizePixel = 0

local topCorner = Instance.new("UICorner",topBar)
topCorner.CornerRadius = UDim.new(0,12)

local topBarFill = Instance.new("Frame",topBar)
topBarFill.BackgroundColor3 = Color3.fromRGB(35,35,50)
topBarFill.Position = UDim2.new(0,0,1,-12)
topBarFill.Size = UDim2.new(1,0,0,12)
topBarFill.BorderSizePixel = 0

local panelTitle = Instance.new("TextLabel",topBar)
panelTitle.BackgroundTransparency = 1
panelTitle.Position = UDim2.new(0,15,0,0)
panelTitle.Size = UDim2.new(0.6,0,1,0)
panelTitle.Text = "Paint Admin Panel PRO"
panelTitle.Font = Enum.Font.GothamBold
panelTitle.TextSize = 18
panelTitle.TextColor3 = Color3.fromRGB(255,255,255)
panelTitle.TextXAlignment = Enum.TextXAlignment.Left

local pss = Instance.new("TextLabel",topBar)
pss.Text = "0 paint/s"
pss.BackgroundTransparency = 1
pss.Position = UDim2.new(0.4,0,0,0)
pss.Size = UDim2.new(0.55,0,1,0)
pss.TextColor3 = Color3.fromRGB(80,255,123)
pss.Font = Enum.Font.GothamBold
pss.TextSize = 14
pss.TextXAlignment = Enum.TextXAlignment.Right
pss.TextYAlignment = Enum.TextYAlignment.Center

local scrollFrame = Instance.new("ScrollingFrame",mainFrame)
scrollFrame.BackgroundTransparency = 1
scrollFrame.Position = UDim2.new(0,0,0,60)
scrollFrame.Size = UDim2.new(1,0,1,-70)
scrollFrame.ScrollBarThickness = 4
scrollFrame.ScrollBarImageColor3 = Color3.fromRGB(255,255,255)
scrollFrame.BorderSizePixel = 0
scrollFrame.CanvasSize = UDim2.new(0,0,0,0)
scrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y

local listlayout = Instance.new("UIListLayout",scrollFrame)
listlayout.Padding = UDim.new(0,12)
listlayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

local uipadding = Instance.new("UIPadding",scrollFrame)
uipadding.PaddingTop = UDim.new(0,15)
uipadding.PaddingBottom = UDim.new(0,15)

local doneButton = Instance.new("TextButton",UI)
doneButton.Visible = false
doneButton.AnchorPoint = Vector2.new(0.5,0)
doneButton.BackgroundColor3 = Color3.fromRGB(0,200,150)
doneButton.Position = UDim2.new(0.5,0,0.05,0)
doneButton.Size = UDim2.new(0,200,0,50)
doneButton.TextColor3 = Color3.fromRGB(255,255,255)
doneButton.Font = Enum.Font.GothamBold
doneButton.TextSize = 16
doneButton.Text = "Done"
doneButton.AutoButtonColor = false
doneButton.BorderSizePixel = 0

local doneCorner = Instance.new("UICorner",doneButton)
doneCorner.CornerRadius = UDim.new(0,10)

local whiteFrame = Instance.new("Frame",mainFrame)
whiteFrame.Size = UDim2.new(1,0,1,0)
whiteFrame.BackgroundColor3 = Color3.fromRGB(255,255,255)
whiteFrame.BorderSizePixel = 0
whiteFrame.ZIndex = 10

local sound = Instance.new("Sound")
sound.SoundId = "rbxassetid://4612386227"
sound.Parent = workspace
local changecolor = Instance.new("Sound")
changecolor.SoundId = "rbxassetid://4612383790"
changecolor.Parent = workspace
local sound2 = Instance.new("Sound")
sound2.SoundId = "rbxassetid://7486747911"
sound2.Parent = workspace
sound2.PlaybackSpeed = 2
local provinceSound = Instance.new("Sound")
provinceSound.SoundId = "rbxassetid://5694665239"
provinceSound.Parent = workspace
local alertSound = Instance.new("Sound")
alertSound.SoundId = "rbxassetid://131961136"
alertSound.Parent = workspace

-- AI SYSTEM VARIABLES --
local aiEnabled = false
local protectedProvinces = {}
local multiAttackThreshold = 3
local fastDefenseMode = false
local lastAttackTime = {}
local attackHistory = {}
local defensePriority = {}

local provinces = {}
local provincespersecond = 0
local pps = 0

local selectColorMode = false
local removeProvincesMode = false
local selectProvincesMode = false
local safeMode = false
local newpaint = false
local painting = true
local keepTerColor = false
local provinceCodeGenerator = 0

local dragging
local dragInput
local dragStart
local startPos

-- AI FUNCTIONS --
local function detectColorChange(province)
    if not protectedProvinces[province] then return end
    
    local currentTime = tick()
    local expectedColor = protectedProvinces[province].expectedColor
    
    if province.Color ~= expectedColor then
        if not lastAttackTime[province] or currentTime - lastAttackTime[province] > 1 then
            lastAttackTime[province] = currentTime
            
            if not attackHistory[province] then
                attackHistory[province] = {}
            end
            table.insert(attackHistory[province], currentTime)
            
            local recentAttacks = 0
            for i = #attackHistory[province], 1, -1 do
                if currentTime - attackHistory[province][i] <= 10 then
                    recentAttacks = recentAttacks + 1
                else
                    break
                end
            end
            
            if recentAttacks >= multiAttackThreshold then
                fastDefenseMode = true
                print("ÇOKLU SALDIRI! Hızlı savunma aktif")
                alertSound:Play()
                
                task.spawn(function()
                    task.wait(15)
                    fastDefenseMode = false
                    print("Normal savunma moduna dönüldü")
                end)
            end
            
            defensePriority[province] = recentAttacks
            return true
        end
    end
    return false
end

local function aiDefenseSystem()
    task.spawn(function()
        while aiEnabled do
            for province, _ in pairs(protectedProvinces) do
                if detectColorChange(province) then
                    if player and player.Character and player.Character:FindFirstChild("PaintBucket") then
                        local args = {
                            [1] = "PaintPart",
                            [2] = {
                                ["Part"] = province,
                                ["Color"] = protectedProvinces[province].expectedColor
                            },
                            [3] = "Peace"
                        }
                        
                        pcall(function()
                            game:GetService("Players").LocalPlayer.Character.PaintBucket.Remotes.ServerControls:InvokeServer(unpack(args))
                        end)
                        
                        provincespersecond = provincespersecond + 1
                    end
                end
            end
            
            task.wait(fastDefenseMode and 0.001 or 0.1)
        end
    end)
end

local function paintProvinceLoop(province,coro,highlighty)
	local savedColor = color
	local active = true

	local eventObject = {}
	function eventObject:Disconnect()
		active = false
		protectedProvinces[province] = nil
	end

	protectedProvinces[province] = {
		expectedColor = savedColor,
		lastCheck = tick()
	}

	task.spawn(function()
		while active do
			if painting then
				if player and player.Character and player.Character:FindFirstChild("PaintBucket") then
					local targetColor = keepTerColor and savedColor or color
					if (province.Color ~= color and keepTerColor == false) or (keepTerColor == true and province.Color ~= savedColor) then
						local args = {
							[1] = "PaintPart",
							[2] = {
								["Part"] = province,
								["Color"] = targetColor
							},
							[3] = "Peace"
						}
						pcall(function()
							game:GetService("Players").LocalPlayer.Character.PaintBucket.Remotes.ServerControls:InvokeServer(unpack(args))
						end)
						provincespersecond = provincespersecond + 1
						
						if protectedProvinces[province] then
							protectedProvinces[province].expectedColor = targetColor
						end
					end
				end
			end

			if safeMode then
				task.wait(1)
			elseif newpaint or fastDefenseMode then
				task.wait(0.01)
			else
				task.wait(0.05)
			end
		end
	end)

	local provinceInfo = {
		["Province"] = province,
		["Coroutine"] = coro,
		["Event"] = eventObject,
		["Highlight"] = highlighty
	}
	table.insert(provinces,provinceInfo)
	provinceCodeGenerator += 1
end

-- MODERN UI FUNCTIONS --
local function createModernButton(text, buttonType, defaultValue)
	local buttonFrame = Instance.new("Frame",scrollFrame)
	buttonFrame.BackgroundColor3 = Color3.fromRGB(35,35,50)
	buttonFrame.Size = UDim2.new(0.9,0,0,60)
	buttonFrame.BorderSizePixel = 0
	
	local corner = Instance.new("UICorner",buttonFrame)
	corner.CornerRadius = UDim.new(0,10)
	
	local label = Instance.new("TextLabel",buttonFrame)
	label.BackgroundTransparency = 1
	label.Position = UDim2.new(0,15,0,0)
	label.Size = UDim2.new(0.65,0,1,0)
	label.Text = text
	label.Font = Enum.Font.GothamBold
	label.TextSize = 15
	label.TextColor3 = Color3.fromRGB(255,255,255)
	label.TextXAlignment = Enum.TextXAlignment.Left
	
	if buttonType == "toggle" then
		local toggleBg = Instance.new("Frame",buttonFrame)
		toggleBg.BackgroundColor3 = Color3.fromRGB(60,60,80)
		toggleBg.Position = UDim2.new(1,-70,0.5,-15)
		toggleBg.Size = UDim2.new(0,50,0,30)
		toggleBg.BorderSizePixel = 0
		
		local toggleCorner = Instance.new("UICorner",toggleBg)
		toggleCorner.CornerRadius = UDim.new(1,0)
		
		local toggleButton = Instance.new("TextButton",toggleBg)
		toggleButton.BackgroundColor3 = Color3.fromRGB(200,200,200)
		toggleButton.Position = UDim2.new(0,3,0.5,-12)
		toggleButton.Size = UDim2.new(0,24,0,24)
		toggleButton.Text = ""
		toggleButton.AutoButtonColor = false
		toggleButton.BorderSizePixel = 0
		
		local btnCorner = Instance.new("UICorner",toggleButton)
		btnCorner.CornerRadius = UDim.new(1,0)
		
		if defaultValue then
			toggleBg.BackgroundColor3 = Color3.fromRGB(0,200,150)
			toggleButton.Position = UDim2.new(1,-27,0.5,-12)
		end
		
		return toggleButton, toggleBg
		
	elseif buttonType == "action" then
		local actionBtn = Instance.new("TextButton",buttonFrame)
		actionBtn.BackgroundColor3 = Color3.fromRGB(60,60,80)
		actionBtn.Position = UDim2.new(1,-70,0.5,-20)
		actionBtn.Size = UDim2.new(0,60,0,40)
		actionBtn.Text = defaultValue or "Click"
		actionBtn.Font = Enum.Font.GothamBold
		actionBtn.TextSize = 13
		actionBtn.TextColor3 = Color3.fromRGB(255,255,255)
		actionBtn.AutoButtonColor = false
		actionBtn.BorderSizePixel = 0
		
		local actionCorner = Instance.new("UICorner",actionBtn)
		actionCorner.CornerRadius = UDim.new(0,8)
		
		return actionBtn
		
	elseif buttonType == "color" then
		local colorBtn = Instance.new("ImageButton",buttonFrame)
		colorBtn.BackgroundColor3 = color
		colorBtn.Position = UDim2.new(1,-50,0.5,-20)
		colorBtn.Size = UDim2.new(0,40,0,40)
		colorBtn.AutoButtonColor = false
		colorBtn.BorderSizePixel = 0
		
		local colorCorner = Instance.new("UICorner",colorBtn)
		colorCorner.CornerRadius = UDim.new(0,8)
		
		return colorBtn
	end
end

local function update(input)
	local delta = input.Position - dragStart
	mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

-- Script --

wait(1)

sound:Play()

tweenService:Create(UIHolder,TweenInfo.new(0.5),{Size = UDim2.new(1,0,1,0)}):Play()
tweenService:Create(mainFrame,TweenInfo.new(0.5),{Rotation = 0}):Play()
tweenService:Create(whiteFrame,TweenInfo.new(0.8),{BackgroundTransparency = 1}):Play()

topBar.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = mainFrame.Position

		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

topBar.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		dragInput = input
	end
end)

userInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		update(input)
	end
end)

-- CREATE MODERN BUTTONS --
local button2 = createModernButton("Country Color", "color")
local button1 = createModernButton("Protect Province", "action", "Add")
local button5 = createModernButton("Unprotect Province", "action", "Remove")
local button3 = createModernButton("Clear Provinces", "action", "Clear")
local button4, button4Bg = createModernButton("Safe Mode", "toggle", false)
local togglePaintButton, togglePaintBg = createModernButton("Toggle Paint", "toggle", true)
local newPaintButton, newPaintBg = createModernButton("Fast Paint", "toggle", false)
local territoryColorButton, territoryColorBg = createModernButton("Keep Territory Color", "toggle", false)
local aiSystemButton, aiSystemBg = createModernButton("AI Defense System", "toggle", false)
local aiSensitivityButton = createModernButton("AI Sensitivity", "action", "3")

-- MOUSE EVENTS --
mouse.Button1Down:Connect(function()
	if mouse.Target and mouse.Target.Name == "Province" then
		if selectColorMode then
			color = mouse.Target.Color
			selectColorMode = false
			UIHolder.Visible = true
			button2.BackgroundColor3 = color
			changecolor:Play()
		end
		if selectProvincesMode then
			provinceSound:Play()
			local clone = mouse.Target:Clone()

			local coro = coroutine.create(paintProvinceLoop)
			coroutine.resume(coro,mouse.Target,coro,clone)

			clone.Position -= Vector3.new(0,0.01,0)
			clone.Material = "Glass"
			clone.Transparency = 1000000
			clone.Parent = provincesFolder
		end
		if removeProvincesMode then
			for _,info in pairs(provinces) do
				if mouse.Target == info.Province then
					coroutine.close(info.Coroutine)
					info.Event:Disconnect()
					info.Highlight:Destroy()
				end
			end
		end
	end
end)

-- BUTTON CONNECTIONS --
button2.MouseButton1Down:Connect(function()
	UIHolder.Visible = false
	selectColorMode = true
end)

button1.MouseButton1Down:Connect(function()
	UIHolder.Visible = false
	selectProvincesMode = true
	doneButton.Visible = true
end)

doneButton.MouseButton1Down:Connect(function()
	removeProvincesMode = false
	selectProvincesMode = false
	UIHolder.Visible = true
	doneButton.Visible = false
end)

button3.MouseButton1Down:Connect(function()
	for _,info in pairs(provinces) do
		coroutine.close(info.Coroutine)
		info.Event:Disconnect()
		info.Highlight:Destroy()
	end
	protectedProvinces = {}
	defensePriority = {}
	attackHistory = {}
	sound2:Play()
end)

button4.MouseButton1Down:Connect(function()
	sound2:Play()
	safeMode = not safeMode
	tweenService:Create(button4Bg,TweenInfo.new(0.2),{BackgroundColor3 = safeMode and Color3.fromRGB(0,200,150) or Color3.fromRGB(60,60,80)}):Play()
	tweenService:Create(button4,TweenInfo.new(0.2),{Position = safeMode and UDim2.new(1,-27,0.5,-12) or UDim2.new(0,3,0.5,-12)}):Play()
end)

button5.MouseButton1Down:Connect(function()
	UIHolder.Visible = false
	removeProvincesMode = true
	doneButton.Visible = true
end)

togglePaintButton.MouseButton1Down:Connect(function()
	sound2:Play()
	painting = not painting
	tweenService:Create(togglePaintBg,TweenInfo.new(0.2),{BackgroundColor3 = painting and Color3.fromRGB(0,200,150) or Color3.fromRGB(60,60,80)}):Play()
	tweenService:Create(togglePaintButton,TweenInfo.new(0.2),{Position = painting and UDim2.new(1,-27,0.5,-12) or UDim2.new(0,3,0.5,-12)}):Play()
end)

newPaintButton.MouseButton1Down:Connect(function()
	sound2:Play()
	newpaint = not newpaint
	tweenService:Create(newPaintBg,TweenInfo.new(0.2),{BackgroundColor3 = newpaint and Color3.fromRGB(0,200,150) or Color3.fromRGB(60,60,80)}):Play()
	tweenService:Create(newPaintButton,TweenInfo.new(0.2),{Position = newpaint and UDim2.new(1,-27,0.5,-12) or UDim2.new(0,3,0.5,-12)}):Play()
end)

territoryColorButton.MouseButton1Down:Connect(function()
	sound2:Play()
	keepTerColor = not keepTerColor
	tweenService:Create(territoryColorBg,TweenInfo.new(0.2),{BackgroundColor3 = keepTerColor and Color3.fromRGB(0,200,150) or Color3.fromRGB(60,60,80)}):Play()
	tweenService:Create(territoryColorButton,TweenInfo.new(0.2),{Position = keepTerColor and UDim2.new(1,-27,0.5,-12) or UDim2.new(0,3,0.5,-12)}):Play()
end)

aiSystemButton.MouseButton1Down:Connect(function()
	sound2:Play()
	aiEnabled = not aiEnabled
	tweenService:Create(aiSystemBg,TweenInfo.new(0.2),{BackgroundColor3 = aiEnabled and Color3.fromRGB(0,200,150) or Color3.fromRGB(60,60,80)}):Play()
	tweenService:Create(aiSystemButton,TweenInfo.new(0.2),{Position = aiEnabled and UDim2.new(1,-27,0.5,-12) or UDim2.new(0,3,0.5,-12)}):Play()
	if aiEnabled then
		print("AI Savunma Sistemi AÇIK")
		aiDefenseSystem()
	else
		print("AI Savunma Sistemi KAPALI")
	end
end)

aiSensitivityButton.MouseButton1Down:Connect(function()
	if multiAttackThreshold == 3 then
		multiAttackThreshold = 5
		aiSensitivityButton.Text = "5"
	elseif multiAttackThreshold == 5 then
		multiAttackThreshold = 2
		aiSensitivityButton.Text = "2"
	else
		multiAttackThreshold = 3
		aiSensitivityButton.Text = "3"
	end
	print("AI Hassasiyet: " .. multiAttackThreshold)
	sound2:Play()
end)

userInputService.InputBegan:Connect(function(input,isTyping)
	if isTyping == false then
		if input.KeyCode == Enum.KeyCode.Q then
			painting = not painting
			tweenService:Create(togglePaintBg,TweenInfo.new(0.2),{BackgroundColor3 = painting and Color3.fromRGB(0,200,150) or Color3.fromRGB(60,60,80)}):Play()
			tweenService:Create(togglePaintButton,TweenInfo.new(0.2),{Position = painting and UDim2.new(1,-27,0.5,-12) or UDim2.new(0,3,0.5,-12)}):Play()
		elseif input.KeyCode == Enum.KeyCode.E then
			aiEnabled = not aiEnabled
			tweenService:Create(aiSystemBg,TweenInfo.new(0.2),{BackgroundColor3 = aiEnabled and Color3.fromRGB(0,200,150) or Color3.fromRGB(60,60,80)}):Play()
			tweenService:Create(aiSystemButton,TweenInfo.new(0.2),{Position = aiEnabled and UDim2.new(1,-27,0.5,-12) or UDim2.new(0,3,0.5,-12)}):Play()
			if aiEnabled then
				print("AI Savunma Sistemi AÇIK (E tuşu)")
				aiDefenseSystem()
			else
				print("AI Savunma Sistemi KAPALI (E tuşu)")
			end
		end
	end
end)

while task.wait(1) do
	pss.TextColor3 = Color3.fromRGB(80, 255, 123)
	if provincespersecond >= 50 then
		pss.TextColor3 = Color3.fromRGB(247, 226, 112)
	end
	if provincespersecond >= 100 then
		pss.TextColor3 = Color3.fromRGB(245, 128, 37)
	end
	if provincespersecond >= 300 then
		pss.TextColor3 = Color3.fromRGB(235, 8, 10)
	end
	if provincespersecond >= 1000 then
		pss.TextColor3 = Color3.fromRGB(235, 0, 120)
	end
	
	local statusText = provincespersecond.." paint/s"
	if aiEnabled then
		statusText = statusText .. " | AI"
		if fastDefenseMode then
			statusText = statusText .. " ⚡"
		end
	end
	
	pss.Text = statusText
	pps = provincespersecond
	provincespersecond = 0
	
	if aiEnabled then
		local currentTime = tick()
		for province, attacks in pairs(attackHistory) do
			for i = #attacks, 1, -1 do
				if currentTime - attacks[i] > 30 then
					table.remove(attacks, i)
				end
			end
			if #attacks == 0 then
				attackHistory[province] = nil
				defensePriority[province] = nil
			end
		end
	end
end
