-- Settings --

local color = Color3.fromRGB(255,255,255)

-- Values --

local userInputService = game:GetService("UserInputService")
local runService = game:GetService("RunService")
local tweenService = game:GetService("TweenService")

local player = game.Players.LocalPlayer
local mouse = player:GetMouse()

local provincesFolder = Instance.new("Model")
provincesFolder.Parent = workspace
local highlight = Instance.new("Highlight")
highlight.FillColor = color
highlight.FillTransparency = 0.8
highlight.Parent = workspace
highlight.Adornee = provincesFolder

local UI = Instance.new("ScreenGui",player.PlayerGui)
local UIHolder = Instance.new("Frame",UI)
UIHolder.AnchorPoint = Vector2.new(0.5,0.5)
UIHolder.BackgroundTransparency = 1
UIHolder.Position = UDim2.new(0.5,0,0.5,0)
UIHolder.Size = UDim2.new(0,0,0,0)
local aspectratio = Instance.new("UIAspectRatioConstraint",UIHolder)
local mainFrame = Instance.new("Frame",UIHolder)
mainFrame.BackgroundColor3 = Color3.fromRGB(33,33,42)
mainFrame.AnchorPoint = Vector2.new(0.5,0.5)
mainFrame.Position = UDim2.new(0.5,0,0.5,0)
mainFrame.Size = UDim2.new(0.5,0,0.276,0)
mainFrame.Rotation = 359
local topBar = Instance.new("Frame",mainFrame)
topBar.BorderColor3 = Color3.fromRGB(0,0,0)
topBar.BackgroundColor3 = Color3.fromRGB(49,49,64)
topBar.Size = UDim2.new(1,0,0.14,0)
local pss = Instance.new("TextLabel",topBar)
pss.Text = "0 paint/second"
pss.AnchorPoint = Vector2.new(0,0.5)
pss.Size = UDim2.new(0.974,0,0.5,0)
pss.Position = UDim2.new(0,0,0.5,0)
pss.TextColor3 = Color3.fromRGB(255,255,255)
pss.BackgroundTransparency = 1
pss.TextScaled = true
pss.TextXAlignment = Enum.TextXAlignment.Right
local scrollFrame = Instance.new("ScrollingFrame",mainFrame)
scrollFrame.BackgroundTransparency = 1
scrollFrame.Position = UDim2.new(0,0,0.14,0)
scrollFrame.Size = UDim2.new(1,0,0.86,0)
scrollFrame.ScrollBarThickness = 0
local panelTitle = Instance.new("TextLabel",topBar)
panelTitle.AnchorPoint = Vector2.new(0,0.5)
panelTitle.BackgroundTransparency = 1
panelTitle.Position = UDim2.new(0.02,0,0.5,0)
panelTitle.Size = UDim2.new(1,0,0.5,0)
panelTitle.Text = '<b>Paint Admin Panel</b><font size="6"> PRO</font>'
panelTitle.RichText = true
panelTitle.TextScaled = true
panelTitle.TextColor3 = Color3.fromRGB(255,255,255)
panelTitle.TextXAlignment = Enum.TextXAlignment.Left
local listlayout = Instance.new("UIListLayout",scrollFrame)
listlayout.Padding = UDim.new(0,10)
local uipadding = Instance.new("UIPadding",scrollFrame)
uipadding.PaddingTop = UDim.new(0,10)
uipadding.PaddingLeft = UDim.new(0,10)
uipadding.PaddingRight = UDim.new(0,10)
uipadding.PaddingBottom = UDim.new(0,10)
local doneButton = Instance.new("TextButton",UI)
doneButton.Visible = false
doneButton.AnchorPoint = Vector2.new(0.5,0)
doneButton.BackgroundColor3 = Color3.fromRGB(0,247,159)
doneButton.Position = UDim2.new(0.5,0,0,0)
doneButton.Size = UDim2.new(0.3,0,0.1,0)
doneButton.TextColor3 = Color3.fromRGB(255,255,255)
doneButton.TextScaled = true
doneButton.Text = "Done"
doneButton.AutoButtonColor = false
doneButton.BorderSizePixel = 0
local whiteFrame = Instance.new("Frame",mainFrame)
whiteFrame.Size = UDim2.new(1,0,1,0)
whiteFrame.BackgroundColor3 = Color3.fromRGB(255,255,255)
local sound = Instance.new("Sound")
sound.SoundId = "rbxassetid://4612386227"
sound.Parent = workspace
local changecolor = Instance.new("Sound")
changecolor.SoundId = "rbxassetid://4612383790"
changecolor.Parent = workspace
local sound2 = Instance.new("Sound")
sound2.SoundId = "rbxassetid://7486747911"
sound2.Parent = workspace
sound2.PlaybackSpeed = 2
local provinceSound = Instance.new("Sound")
provinceSound.SoundId = "rbxassetid://5694665239"
provinceSound.Parent = workspace

-- DRAG SELECT VARIABLES --
local dragSelectMode = false
local isDragging = false
local dragConnection = nil
local selectedInDrag = {}

-- AI ASSISTANT VARIABLES --
local autoRepairMode = false
local autoRepairConnection = nil
local enemyColors = {}
local playerOriginalColor = Color3.fromRGB(255,255,255)

-- ADVANCED AI PROTECTION VARIABLES --
local superProtectionMode = false
local protectionConnections = {}
local protectionZones = {} -- Korunan b√∂lgelerin listesi
local lastColorCheck = {}  -- Her b√∂lge i√ßin son renk kontrol√º
local protectionStrength = "ULTRA" -- Normal, High, Ultra seviyeleri
local antiBypassMode = true -- Bypass korumasƒ±
local instantProtection = true -- Anƒ±nda koruma
local protectionRadius = 50 -- Koruma yarƒ±√ßapƒ±

-- GELI≈ûMI≈û AI KORUMA FONKSƒ∞YONLARI --
local function addToProtectionZone(province)
    if not protectionZones[province] then
        protectionZones[province] = {
            ["Province"] = province,
            ["OriginalColor"] = color,
            ["LastCheck"] = tick(),
            ["ProtectionLevel"] = protectionStrength,
            ["Violations"] = 0
        }
        lastColorCheck[province] = province.Color
        print("üõ°Ô∏è PROTECTION: Added", province.Name, "to protection zone")
    end
end

local function removeFromProtectionZone(province)
    if protectionZones[province] then
        protectionZones[province] = nil
        lastColorCheck[province] = nil
        print("üõ°Ô∏è PROTECTION: Removed", province.Name, "from protection zone")
    end
end

local function instantProtectionRepair(province, intruderColor)
    -- ANINDA KORUMA - 3 KATLI SAVUNMA
    
    -- 1. KAT: Hƒ±zlƒ± Boyama (0.001 saniye)
    task.spawn(function()
        for i = 1, 3 do
            if province.Color ~= color then
                local args = {
                    [1] = "PaintPart",
                    [2] = {
                        ["Part"] = province,
                        ["Color"] = color
                    },
                    [3] = "Peace"
                }
                pcall(function()
                    game:GetService("Players").LocalPlayer.Character.PaintBucket.Remotes.ServerControls:InvokeServer(unpack(args))
                end)
                task.wait(0.001) -- Ultra hƒ±zlƒ±
            end
        end
    end)
    
    -- 2. KAT: √áevre Koruma (Yakƒ±n b√∂lgeleri de kontrol et)
    task.spawn(function()
        local pos = province.Position
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj.Name == "Province" and obj:IsA("BasePart") and obj ~= province then
                local distance = (obj.Position - pos).Magnitude
                if distance < protectionRadius and obj.Color == intruderColor then
                    -- D√º≈üman rengindeki yakƒ±n b√∂lgeleri de boyar
                    local args = {
                        [1] = "PaintPart",
                        [2] = {
                            ["Part"] = obj,
                            ["Color"] = color
                        },
                        [3] = "Peace"
                    }
                    pcall(function()
                        game:GetService("Players").LocalPlayer.Character.PaintBucket.Remotes.ServerControls:InvokeServer(unpack(args))
                    end)
                end
            end
        end
    end)
    
    -- 3. KAT: S√ºrekli ƒ∞zleme (Bu b√∂lgeyi 5 saniye daha yoƒüun izle)
    task.spawn(function()
        for i = 1, 50 do -- 5 saniye boyunca her 0.1 saniyede
            if province.Color ~= color then
                local args = {
                    [1] = "PaintPart",
                    [2] = {
                        ["Part"] = province,
                        ["Color"] = color
                    },
                    [3] = "Peace"
                }
                pcall(function()
                    game:GetService("Players").LocalPlayer.Character.PaintBucket.Remotes.ServerControls:InvokeServer(unpack(args))
                end)
            end
            task.wait(0.1)
        end
    end)
    
    print("üö® INSTANT PROTECTION: Defended", province.Name, "from", intruderColor)
end

local function startSuperProtection()
    if protectionConnections.main then
        protectionConnections.main:Disconnect()
    end
    
    protectionConnections.main = runService.Heartbeat:Connect(function()
        if superProtectionMode then
            -- Her frame'de t√ºm korunan b√∂lgeleri kontrol et
            for province, info in pairs(protectionZones) do
                if province and province.Parent then
                    local currentColor = province.Color
                    local expectedColor = info.OriginalColor
                    
                    -- Renk deƒüi≈üti mi kontrol et
                    if currentColor ~= expectedColor then
                        info.Violations = info.Violations + 1
                        
                        -- ANINDA M√úDAHALE
                        instantProtectionRepair(province, currentColor)
                        
                        -- ƒ∞statistik g√ºncelle
                        provincespersecond = provincespersecond + 1
                        
                        print("‚ö° SUPER PROTECTION: Violation #" .. info.Violations .. " on " .. province.Name)
                    end
                    
                    lastColorCheck[province] = currentColor
                end
            end
        end
    end)
    
    -- SECONDARY PROTECTION - BackgroundTask
    protectionConnections.secondary = task.spawn(function()
        while superProtectionMode do
            for province, info in pairs(protectionZones) do
                if province and province.Parent and province.Color ~= info.OriginalColor then
                    -- √áift kontrol sistemi
                    task.spawn(function()
                        local args = {
                            [1] = "PaintPart",
                            [2] = {
                                ["Part"] = province,
                                ["Color"] = info.OriginalColor
                            },
                            [3] = "Peace"
                        }
                        pcall(function()
                            game:GetService("Players").LocalPlayer.Character.PaintBucket.Remotes.ServerControls:InvokeServer(unpack(args))
                        end)
                    end)
                end
            end
            task.wait(0.05) -- Her 0.05 saniyede ek kontrol
        end
    end)
    
    print("üõ°Ô∏è SUPER PROTECTION: ACTIVATED - Protecting", table.getn(protectionZones), "zones")
end

local function stopSuperProtection()
    if protectionConnections.main then
        protectionConnections.main:Disconnect()
        protectionConnections.main = nil
    end
    if protectionConnections.secondary then
        task.cancel(protectionConnections.secondary)
        protectionConnections.secondary = nil
    end
    print("üõ°Ô∏è SUPER PROTECTION: DEACTIVATED")
end

-- EXISTING FUNCTIONS (Original code continues...)
local provincespersecond = 0
local pps = 0

local selectColorMode = false
local removeProvincesMode = false
local selectProvincesMode = false
local safeMode = false
local newpaint = false
local painting = true
local keepTerColor = false

local provinceCodeGenerator = 0

local dragging
local dragInput
local dragStart
local startPos

-- Existing functions... (keeping original paintProvinceLoop, detectEnemyColors etc.)

local function detectEnemyColors()
    local detectedColors = {}
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj.Name == "Province" and obj:IsA("BasePart") then
            if obj.Color ~= color and obj.Color ~= playerOriginalColor then
                local isEnemyColor = true
                for _, friendlyColor in pairs({color, playerOriginalColor}) do
                    if obj.Color == friendlyColor then
                        isEnemyColor = false
                        break
                    end
                end
                
                if isEnemyColor then
                    local colorExists = false
                    for _, existingColor in pairs(detectedColors) do
                        if existingColor == obj.Color then
                            colorExists = true
                            break
                        end
                    end
                    if not colorExists then
                        table.insert(detectedColors, obj.Color)
                    end
                end
            end
        end
    end
    return detectedColors
end

local function startAutoRepair()
    if autoRepairConnection then
        autoRepairConnection:Disconnect()
    end
    
    autoRepairConnection = task.spawn(function()
        while autoRepairMode do
            for _, info in pairs(provinces) do
                if info.Province and info.Province.Parent then
                    if info.Province.Color ~= color then
                        print("ü§ñ AI: Repairing lost province:", info.Province.Name)
                        
                        if player and player.Character and player.Character:FindFirstChild("PaintBucket") then
                            local args = {
                                [1] = "PaintPart",
                                [2] = {
                                    ["Part"] = info.Province,
                                    ["Color"] = color
                                },
                                [3] = "Peace"
                            }
                            pcall(function()
                                game:GetService("Players").LocalPlayer.Character.PaintBucket.Remotes.ServerControls:InvokeServer(unpack(args))
                            end)
                        end
                    end
                end
            end
            
            task.wait(0.5)
        end
    end)
end

local function findNewTargets()
    local newTargets = {}
    for _, info in pairs(provinces) do
        if info.Province and info.Province.Parent then
            local pos = info.Province.Position
            for _, obj in pairs(workspace:GetDescendants()) do
                if obj.Name == "Province" and obj:IsA("BasePart") and obj ~= info.Province then
                    local distance = (obj.Position - pos).Magnitude
                    if distance < 50 and obj.Color ~= color then
                        local alreadyProtected = false
                        for _, protectedInfo in pairs(provinces) do
                            if protectedInfo.Province == obj then
                                alreadyProtected = true
                                break
                            end
                        end
                        
                        if not alreadyProtected then
                            table.insert(newTargets, obj)
                        end
                    end
                end
            end
        end
    end
    return newTargets
end

local function startDragSelect()
    if dragConnection then
        dragConnection:Disconnect()
    end
    
    dragConnection = mouse.Move:Connect(function()
        if isDragging and dragSelectMode then
            if mouse.Target and mouse.Target.Name == "Province" then
                local alreadySelected = false
                
                for _, info in pairs(provinces) do
                    if info.Province == mouse.Target then
                        alreadySelected = true
                        break
                    end
                end
                
                if not alreadySelected then
                    for _, selected in pairs(selectedInDrag) do
                        if selected == mouse.Target then
                            alreadySelected = true
                            break
                        end
                    end
                end
                
                if not alreadySelected then
                    table.insert(selectedInDrag, mouse.Target)
                    
                    local clone = mouse.Target:Clone()
                    clone.Position -= Vector3.new(0, 0.01, 0)
                    clone.Material = "Glass"
                    clone.Transparency = 1000000
                    clone.Parent = provincesFolder
                    
                    local coro = coroutine.create(paintProvinceLoop)
                    coroutine.resume(coro, mouse.Target, coro, clone)
                    
                    local tempHighlight = Instance.new("SelectionBox")
                    tempHighlight.Adornee = mouse.Target
                    tempHighlight.Color3 = Color3.fromRGB(0, 255, 0)
                    tempHighlight.Parent = mouse.Target
                    tempHighlight.Transparency = 0.3
                    
                    task.spawn(function()
                        task.wait(0.5)
                        if tempHighlight then
                            tempHighlight:Destroy()
                        end
                    end)
                    
                    print("Added via drag:", mouse.Target.Name, "Total selected:", #selectedInDrag)
                end
            end
        end
    end)
end

local function finishDragSelect()
    if dragConnection then
        dragConnection:Disconnect()
        dragConnection = nil
    end
    
    if #selectedInDrag > 0 then
        print("Added " .. #selectedInDrag .. " provinces via drag select!")
    end
    
    selectedInDrag = {}
    isDragging = false
end

local function paintProvinceLoop(province,coro,highlighty)
    local savedColor = color
    local active = true

    local eventObject = {}
    function eventObject:Disconnect()
        active = false
    end

    task.spawn(function()
        while active do
            if painting then
                if player and player.Character and player.Character:FindFirstChild("PaintBucket") then
                    local currentTargetColor = keepTerColor and savedColor or color
                    
                    if province.Color ~= currentTargetColor then
                        local args = {
                            [1] = "PaintPart",
                            [2] = {
                                ["Part"] = province,
                                ["Color"] = currentTargetColor
                            },
                            [3] = "Peace"
                        }
                        local success = pcall(function()
                            game:GetService("Players").LocalPlayer.Character.PaintBucket.Remotes.ServerControls:InvokeServer(unpack(args))
                        end)
                        
                        if success then
                            provincespersecond = provincespersecond + 1
                            if math.random(1,20) == 1 then
                                print("Painting:", province.Name, "Current PPS:", provincespersecond)
                            end
                        end
                    end
                else
                    if math.random(1,100) == 1 then
                        print("PaintBucket not found!")
                    end
                end
            end

            if safeMode then
                task.wait(0.3)
            elseif newpaint then
                task.wait(0.001)
            else
                task.wait(0.02)
            end
        end
    end)

    local provinceInfo = {
        ["Province"] = province,
        ["Coroutine"] = coro,
        ["Event"] = eventObject,
        ["Highlight"] = highlighty
    }
    table.insert(provinces,provinceInfo)
    provinceCodeGenerator += 1
    
    print("Started paintProvinceLoop for:", province.Name, "Total active provinces:", #provinces)
end

local function createNewOption(optionType,text,customText,enabled)
    local optionFrame = Instance.new("Frame",scrollFrame)
    optionFrame.BorderColor3 = Color3.fromRGB(0,0,0)
    optionFrame.BackgroundColor3 = Color3.fromRGB(49, 49, 64)
    optionFrame.Size = UDim2.new(1,0,0.075,0)
    optionFrame.Parent = scrollFrame
    local textlabel = Instance.new("TextLabel",optionFrame)
    textlabel.BackgroundTransparency = 1
    textlabel.Position = UDim2.new(0.02,0,0.2,0)
    textlabel.Size = UDim2.new(1,0,0.6,0)
    textlabel.TextScaled = true
    textlabel.Text = text
    textlabel.Font = Enum.Font.SourceSansBold
    textlabel.TextColor3 = Color3.fromRGB(255,255,255)
    textlabel.TextXAlignment = Enum.TextXAlignment.Left
    if optionType == "switch" then
        local switchFrame = Instance.new("Frame",optionFrame)
        switchFrame.BackgroundColor3 = Color3.fromRGB(241, 33, 103)
        switchFrame.Position = UDim2.new(0.865,0,0.125,0)
        switchFrame.Size = UDim2.new(0.125,0,0.75,0)
        switchFrame.BorderSizePixel = 0
        local switch = Instance.new("ImageButton",switchFrame)
        switch.AutoButtonColor = false
        switch.BorderSizePixel = 0
        switch.Size = UDim2.new(1,0,1,0)
        switch.BackgroundColor3 = Color3.fromRGB(255,255,255)
        local aspectRatio = Instance.new("UIAspectRatioConstraint",switch)
        if enabled then
            tweenService:Create(switch.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(53, 227, 153)}):Play()
            tweenService:Create(switch,TweenInfo.new(0.1),{Position = UDim2.new(1,0,0,0)}):Play()
            tweenService:Create(switch,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(1,0)}):Play()
        end
        return switch
    elseif optionType == "color" then
        local colorButton = Instance.new("ImageButton",optionFrame)
        colorButton.Position = UDim2.new(0.928,0,0.125,0)
        colorButton.AutoButtonColor = false
        colorButton.Size = UDim2.new(0.062,0,0.75,0)
        return colorButton
    elseif optionType == "custom" then
        local button = Instance.new("ImageButton",optionFrame)
        button.BackgroundColor3 = Color3.fromRGB(100,100,100)
        button.Position = UDim2.new(0.865,0,0.125,0)
        button.Size = UDim2.new(0.125,0,0.75,0)
        button.AutoButtonColor = false
        local textlabel = Instance.new("TextLabel",button)
        textlabel.BackgroundTransparency = 1
        textlabel.Position = UDim2.new(0.5,0,0.5,0)
        textlabel.AnchorPoint = Vector2.new(0.5,0.5)
        textlabel.Size = UDim2.new(0.8,0,0.8,0)
        textlabel.Text = customText
        textlabel.TextScaled = true
        textlabel.Font = Enum.Font.SourceSansBold
        textlabel.TextColor3 = Color3.fromRGB(255,255,255)
        return button
    end
end

local function update(input)
    local delta = input.Position - dragStart
    mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

-- Script --

wait(1)

sound:Play()

if userInputService.MouseEnabled == false then
    tweenService:Create(UIHolder,TweenInfo.new(0.5),{Size = UDim2.new(1.5,0,1.5,0)}):Play()
else
    tweenService:Create(UIHolder,TweenInfo.new(0.5),{Size = UDim2.new(0.75,0,0.75,0)}):Play()
end
tweenService:Create(mainFrame,TweenInfo.new(0.5),{Rotation = 0}):Play()
tweenService:Create(whiteFrame,TweenInfo.new(4),{BackgroundTransparency = 1}):Play()

topBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

topBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

userInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- UI BUTONLARI --
local button2 = createNewOption("color","Country Color")
local button1 = createNewOption("custom","Protect Province","Add")
local dragSelectButton = createNewOption("custom","üñ±Ô∏è Drag Select","Drag")
local button5 = createNewOption("custom","Unprotect Province","Remove")
local button3 = createNewOption("custom","Clear Provinces","Clear")
local button4 = createNewOption("switch","Safe Mode")
local togglePaintButton = createNewOption("switch","Toggle Paint",nil,true)
local newPaintButton = createNewOption("switch","Fast Paint")
local territoryColorButton = createNewOption("switch","Keep Territory Color (NEW)")
local randomColorButton = createNewOption("custom","Randomize color (NEW)","Change")

-- AI ASSISTANT UI --
local autoRepairButton = createNewOption("switch","ü§ñ Auto Repair")
local expandTerritoryButton = createNewOption("custom","üöÄ Auto Expand","Expand")
local aiStatusButton = createNewOption("custom","üìä AI Status","Status")

-- NEW SUPER PROTECTION UI --
local superProtectionButton = createNewOption("switch","üõ°Ô∏è SUPER PROTECTION")
local protectZoneButton = createNewOption("custom","üè∞ Protect Zone","Protect")
local clearZoneButton = createNewOption("custom","üßπ Clear Zones","Clear")
local protectionStatsButton = createNewOption("custom","üìà Protection Stats","Stats")

-- MOUSE KONTROLLERI --
mouse.Button1Down:Connect(function()
    if dragSelectMode then
        isDragging = true
        startDragSelect()
        
        if mouse.Target and mouse.Target.Name == "Province" then
            local alreadySelected = false
            for _, info in pairs(provinces) do
                if info.Province == mouse.Target then
                    alreadySelected = true
                    break
                end
            end
            
            if not alreadySelected then
                table.insert(selectedInDrag, mouse.Target)
                
                provinceSound:Play()
                
                local clone = mouse.Target:Clone()
                clone.Position -= Vector3.new(0, 0.01, 0)
                clone.Material = "Glass"
                clone.Transparency = 1000000
                clone.Parent = provincesFolder
                
                local coro = coroutine.create(paintProvinceLoop)
                coroutine.resume(coro, mouse.Target, coro, clone)
                
                print("Drag select started with:", mouse.Target.Name)
            end
        end
        return
    end
    
    if mouse.Target and mouse.Target.Name == "Province" then
        if selectColorMode then
            color = mouse.Target.Color
            selectColorMode = false
            UIHolder.Visible = true
            button2.BackgroundColor3 = color
            changecolor:Play()
        end
        if selectProvincesMode then
            provinceSound:Play()
            local clone = mouse.Target:Clone()

            local coro = coroutine.create(paintProvinceLoop)
            coroutine.resume(coro,mouse.Target,coro,clone)

            clone.Position -= Vector3.new(0,0.01,0)
            clone.Material = "Glass"
            clone.Transparency = 1000000
            clone.Parent = provincesFolder
        end
        if removeProvincesMode then
            for _,info in pairs(provinces) do
                if mouse.Target == info.Province then
                    coroutine.close(info.Coroutine)
                    info.Event:Disconnect()
                    info.Highlight:Destroy()
                end
            end
        end
    end
end)

mouse.Button1Up:Connect(function()
    if dragSelectMode and isDragging then
        finishDragSelect()
    end
end)

-- ORIGINAL BUTTON CONNECTIONS --
button2.BackgroundColor3 = color
button2.MouseButton1Down:Connect(function()
    UIHolder.Visible = false
    selectColorMode = true
end)

button1.MouseButton1Down:Connect(function()
    UIHolder.Visible = false
    selectProvincesMode = true
    doneButton.Visible = true
end)

dragSelectButton.MouseButton1Down:Connect(function()
    UIHolder.Visible = false
    dragSelectMode = true
    doneButton.Visible = true
    doneButton.Text = "Finish Drag"
end)

doneButton.MouseButton1Down:Connect(function()
    removeProvincesMode = false
    selectProvincesMode = false
    dragSelectMode = false
    UIHolder.Visible = true
    doneButton.Visible = false
    doneButton.Text = "Done"
    
    if dragConnection then
        dragConnection:Disconnect()
        dragConnection = nil
    end
end)

button3.MouseButton1Down:Connect(function()
    for _,info in pairs(provinces) do
        coroutine.close(info.Coroutine)
        info.Event:Disconnect()
        info.Highlight:Destroy()
    end
    provinces = {}
    for _,child in pairs(provincesFolder:GetChildren()) do
        child:Destroy()
    end
end)

button4.MouseButton1Down:Connect(function()
    sound2:Play()
    if safeMode then
        safeMode = false
        tweenService:Create(button4.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(241, 33, 103)}):Play()
        tweenService:Create(button4,TweenInfo.new(0.1),{Position = UDim2.new(0,0,0,0)}):Play()
        tweenService:Create(button4,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(0,0)}):Play()
    else
        safeMode = true
        tweenService:Create(button4.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(53, 227, 153)}):Play()
        tweenService:Create(button4,TweenInfo.new(0.1),{Position = UDim2.new(1,0,0,0)}):Play()
        tweenService:Create(button4,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(1,0)}):Play()
    end
end)

button5.MouseButton1Down:Connect(function()
    UIHolder.Visible = false
    removeProvincesMode = true
    doneButton.Visible = true
end)

togglePaintButton.MouseButton1Down:Connect(function()
    sound2:Play()
    if painting then
        painting = false
        tweenService:Create(togglePaintButton.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(241, 33, 103)}):Play()
        tweenService:Create(togglePaintButton,TweenInfo.new(0.1),{Position = UDim2.new(0,0,0,0)}):Play()
        tweenService:Create(togglePaintButton,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(0,0)}):Play()
    else
        painting = true
        tweenService:Create(togglePaintButton.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(53, 227, 153)}):Play()
        tweenService:Create(togglePaintButton,TweenInfo.new(0.1),{Position = UDim2.new(1,0,0,0)}):Play()
        tweenService:Create(togglePaintButton,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(1,0)}):Play()
    end
end)

newPaintButton.MouseButton1Down:Connect(function()
    sound2:Play()
    if newpaint then
        newpaint = false
        tweenService:Create(newPaintButton.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(241, 33, 103)}):Play()
        tweenService:Create(newPaintButton,TweenInfo.new(0.1),{Position = UDim2.new(0,0,0,0)}):Play()
        tweenService:Create(newPaintButton,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(0,0)}):Play()
    else
        newpaint = true
        tweenService:Create(newPaintButton.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(53, 227, 153)}):Play()
        tweenService:Create(newPaintButton,TweenInfo.new(0.1),{Position = UDim2.new(1,0,0,0)}):Play()
        tweenService:Create(newPaintButton,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(1,0)}):Play()
    end
end)

territoryColorButton.MouseButton1Down:Connect(function()
    sound2:Play()
    if keepTerColor then
        keepTerColor = false
        tweenService:Create(territoryColorButton.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(241, 33, 103)}):Play()
        tweenService:Create(territoryColorButton,TweenInfo.new(0.1),{Position = UDim2.new(0,0,0,0)}):Play()
        tweenService:Create(territoryColorButton,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(0,0)}):Play()
    else
        keepTerColor = true
        tweenService:Create(territoryColorButton.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(53, 227, 153)}):Play()
        tweenService:Create(territoryColorButton,TweenInfo.new(0.1),{Position = UDim2.new(1,0,0,0)}):Play()
        tweenService:Create(territoryColorButton,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(1,0)}):Play()
    end
end)

randomColorButton.MouseButton1Down:Connect(function()
    color = Color3.fromRGB(math.random(0,255),math.random(0,255),math.random(0,255))
    button2.BackgroundColor3 = color
    changecolor:Play()
end)

-- AI ASSISTANT BUTTON CONNECTIONS --
autoRepairButton.MouseButton1Down:Connect(function()
    sound2:Play()
    if autoRepairMode then
        autoRepairMode = false
        if autoRepairConnection then
            autoRepairConnection:Disconnect()
        end
        tweenService:Create(autoRepairButton.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(241, 33, 103)}):Play()
        tweenService:Create(autoRepairButton,TweenInfo.new(0.1),{Position = UDim2.new(0,0,0,0)}):Play()
        tweenService:Create(autoRepairButton,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(0,0)}):Play()
        print("ü§ñ AI Auto-Repair: OFF")
    else
        autoRepairMode = true
        startAutoRepair()
        tweenService:Create(autoRepairButton.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(53, 227, 153)}):Play()
        tweenService:Create(autoRepairButton,TweenInfo.new(0.1),{Position = UDim2.new(1,0,0,0)}):Play()
        tweenService:Create(autoRepairButton,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(1,0)}):Play()
        print("ü§ñ AI Auto-Repair: ON - Protecting", #provinces, "provinces")
    end
end)

expandTerritoryButton.MouseButton1Down:Connect(function()
    local newTargets = findNewTargets()
    print("üöÄ AI Expansion: Found", #newTargets, "new targets")
    
    for _, target in pairs(newTargets) do
        local clone = target:Clone()
        clone.Position -= Vector3.new(0, 0.01, 0)
        clone.Material = "Glass"  
        clone.Transparency = 1000000
        clone.Parent = provincesFolder
        
        local coro = coroutine.create(paintProvinceLoop)
        coroutine.resume(coro, target, coro, clone)
        
        print("üéØ AI Added:", target.Name)
    end
    
    if #newTargets > 0 then
        provinceSound:Play()
    end
end)

aiStatusButton.MouseButton1Down:Connect(function()
    enemyColors = detectEnemyColors()
    print("üìä AI STATUS REPORT:")
    print("üèõÔ∏è Protected Provinces:", #provinces)
    print("üé® Current Color:", color)
    print("üî• Auto-Repair:", autoRepairMode and "ON" or "OFF")
    print("üëπ Enemy Colors Detected:", #enemyColors)
    print("‚ö° Paint Speed:", newpaint and "FAST" or (safeMode and "SAFE" or "NORMAL"))
    print("üñºÔ∏è Painting Active:", painting and "YES" or "NO")
    print("üõ°Ô∏è Super Protection:", superProtectionMode and "ACTIVE" or "INACTIVE")
    print("üè∞ Protected Zones:", table.getn(protectionZones))
    
    for i, enemyColor in pairs(enemyColors) do
        print("   Enemy Color " .. i .. ":", enemyColor)
    end
end)

-- NEW SUPER PROTECTION BUTTON CONNECTIONS --
superProtectionButton.MouseButton1Down:Connect(function()
    sound2:Play()
    if superProtectionMode then
        superProtectionMode = false
        stopSuperProtection()
        tweenService:Create(superProtectionButton.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(241, 33, 103)}):Play()
        tweenService:Create(superProtectionButton,TweenInfo.new(0.1),{Position = UDim2.new(0,0,0,0)}):Play()
        tweenService:Create(superProtectionButton,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(0,0)}):Play()
        print("üõ°Ô∏è SUPER PROTECTION: DISABLED")
    else
        superProtectionMode = true
        startSuperProtection()
        tweenService:Create(superProtectionButton.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(53, 227, 153)}):Play()
        tweenService:Create(superProtectionButton,TweenInfo.new(0.1),{Position = UDim2.new(1,0,0,0)}):Play()
        tweenService:Create(superProtectionButton,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(1,0)}):Play()
        print("üõ°Ô∏è SUPER PROTECTION: ENABLED")
        
        -- Mevcut t√ºm province'leri koruma altƒ±na al
        for _, info in pairs(provinces) do
            if info.Province then
                addToProtectionZone(info.Province)
            end
        end
    end
end)

protectZoneButton.MouseButton1Down:Connect(function()
    UIHolder.Visible = false
    doneButton.Visible = true
    doneButton.Text = "Done Protecting"
    
    -- √ñzel koruma modu - tƒ±klanan b√∂lgeleri sadece koruma altƒ±na al
    local protectMode = true
    local tempConnection
    
    tempConnection = mouse.Button1Down:Connect(function()
        if mouse.Target and mouse.Target.Name == "Province" and protectMode then
            addToProtectionZone(mouse.Target)
            provinceSound:Play()
            
            -- G√∂rsel feedback
            local tempHighlight = Instance.new("SelectionBox")
            tempHighlight.Adornee = mouse.Target
            tempHighlight.Color3 = Color3.fromRGB(0, 255, 255) -- Cyan renk
            tempHighlight.Parent = mouse.Target
            tempHighlight.Transparency = 0.2
            
            task.spawn(function()
                task.wait(2)
                if tempHighlight then
                    tempHighlight:Destroy()
                end
            end)
            
            print("üè∞ Added to protection zone:", mouse.Target.Name)
        end
    end)
    
    -- Done butonu basƒ±ldƒ±ƒüƒ±nda koruma modunu kapat
    local originalDoneConnection = doneButton.MouseButton1Down:Connect(function()
        protectMode = false
        if tempConnection then
            tempConnection:Disconnect()
        end
    end)
end)

clearZoneButton.MouseButton1Down:Connect(function()
    -- T√ºm koruma b√∂lgelerini temizle
    protectionZones = {}
    lastColorCheck = {}
    print("üßπ All protection zones cleared!")
    changecolor:Play()
end)

protectionStatsButton.MouseButton1Down:Connect(function()
    print("üìà PROTECTION STATISTICS:")
    print("üõ°Ô∏è Total Protected Zones:", table.getn(protectionZones))
    print("üö® Protection Mode:", superProtectionMode and "ACTIVE" or "INACTIVE")
    print("‚ö° Protection Strength:", protectionStrength)
    print("üèÉ‚Äç‚ôÇÔ∏è Instant Protection:", instantProtection and "ON" or "OFF")
    print("üìè Protection Radius:", protectionRadius, "units")
    
    local totalViolations = 0
    for province, info in pairs(protectionZones) do
        totalViolations = totalViolations + info.Violations
        if info.Violations > 0 then
            print("   ‚ö†Ô∏è", province.Name, "- Violations:", info.Violations)
        end
    end
    print("üî¢ Total Violations Blocked:", totalViolations)
end)

-- KEYBOARD SHORTCUTS --
userInputService.InputBegan:Connect(function(input,isTyping)
    if isTyping == false then
        if input.KeyCode == Enum.KeyCode.R then
            color = Color3.fromRGB(math.random(0,255),math.random(0,255),math.random(0,255))
            button2.BackgroundColor3 = color
            changecolor:Play()
        elseif input.KeyCode == Enum.KeyCode.Q then
            if painting then
                painting = false
                tweenService:Create(togglePaintButton.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(241, 33, 103)}):Play()
                tweenService:Create(togglePaintButton,TweenInfo.new(0.1),{Position = UDim2.new(0,0,0,0)}):Play()
                tweenService:Create(togglePaintButton,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(0,0)}):Play()
            else
                painting = true
                tweenService:Create(togglePaintButton.Parent,TweenInfo.new(0.1),{BackgroundColor3 = Color3.fromRGB(53, 227, 153)}):Play()
                tweenService:Create(togglePaintButton,TweenInfo.new(0.1),{Position = UDim2.new(1,0,0,0)}):Play()
                tweenService:Create(togglePaintButton,TweenInfo.new(0.1),{AnchorPoint = Vector2.new(1,0)}):Play()
            end
        elseif input.KeyCode == Enum.KeyCode.P then
            -- P tu≈üu ile hƒ±zlƒ± super protection toggle
            superProtectionMode = not superProtectionMode
            if superProtectionMode then
                startSuperProtection()
                print("üõ°Ô∏è SUPER PROTECTION: ENABLED (Hotkey)")
            else
                stopSuperProtection()
                print("üõ°Ô∏è SUPER PROTECTION: DISABLED (Hotkey)")
            end
        end
    end
end)

-- PERFORMANCE MONITORING LOOP --
while task.wait(1) do
    pss.TextColor3 = Color3.fromRGB(80, 255, 123)
    if provincespersecond >= 50 then
        pss.TextColor3 = Color3.fromRGB(247, 226, 112)
    end
    if provincespersecond >= 100 then
        pss.TextColor3 = Color3.fromRGB(245, 128, 37)
    end
    if provincespersecond >= 300 then
        pss.TextColor3 = Color3.fromRGB(235, 8, 10)
    end
    if provincespersecond >= 1000 then
        pss.TextColor3 = Color3.fromRGB(235, 0, 120)
    end
    
    -- Super Protection aktifse √∂zel g√∂sterge
    local protectionText = ""
    if superProtectionMode then
        protectionText = " üõ°Ô∏è"
    end
    
    pss.Text = provincespersecond.." paint/second"..protectionText
    pps = provincespersecond
    provincespersecond = 0
    
    -- Her saniye koruma durumunu kontrol et
    if superProtectionMode then
        local activeZones = 0
        for province, info in pairs(protectionZones) do
            if province and province.Parent then
                activeZones = activeZones + 1
            else
                -- Silinmi≈ü province'leri temizle
                protectionZones[province] = nil
                lastColorCheck[province] = nil
            end
        end
        
        if activeZones > 0 and math.random(1, 10) == 1 then -- Her 10 saniyede bir log
            print("üõ°Ô∏è Active Protection Zones:", activeZones)
        end
    end
end
