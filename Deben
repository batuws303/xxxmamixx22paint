-- Settings
local color = Color3.fromRGB(255,255,255)

local userInputService = game:GetService("UserInputService")
local runService = game:GetService("RunService")
local tweenService = game:GetService("TweenService")

local player = game.Players.LocalPlayer
local mouse = player:GetMouse()

local provincesFolder = Instance.new("Model")
provincesFolder.Parent = workspace
local highlight = Instance.new("Highlight")
highlight.FillColor = color
highlight.FillTransparency = 0.8
highlight.Parent = workspace
highlight.Adornee = provincesFolder

-- GUI
local UI = Instance.new("ScreenGui",player.PlayerGui)
local UIHolder = Instance.new("Frame",UI)
UIHolder.AnchorPoint = Vector2.new(0.5,0.5)
UIHolder.BackgroundTransparency = 1
UIHolder.Position = UDim2.new(0.5,0,0.5,0)
UIHolder.Size = UDim2.new(0,0,0,0)

local mainFrame = Instance.new("Frame",UIHolder)
mainFrame.BackgroundColor3 = Color3.fromRGB(33,33,42)
mainFrame.AnchorPoint = Vector2.new(0.5,0.5)
mainFrame.Position = UDim2.new(0.5,0,0.5,0)
mainFrame.Size = UDim2.new(0.5,0,0.276,0)
mainFrame.Rotation = 359

local topBar = Instance.new("Frame",mainFrame)
topBar.BorderColor3 = Color3.fromRGB(0,0,0)
topBar.BackgroundColor3 = Color3.fromRGB(49,49,64)
topBar.Size = UDim2.new(1,0,0.14,0)

local pss = Instance.new("TextLabel",topBar)
pss.Text = "0 paint/second"
pss.AnchorPoint = Vector2.new(0,0.5)
pss.Size = UDim2.new(0.974,0,0.5,0)
pss.Position = UDim2.new(0,0,0.5,0)
pss.TextColor3 = Color3.fromRGB(255,255,255)
pss.BackgroundTransparency = 1
pss.TextScaled = true
pss.TextXAlignment = Enum.TextXAlignment.Right

local scrollFrame = Instance.new("ScrollingFrame",mainFrame)
scrollFrame.BackgroundTransparency = 1
scrollFrame.Position = UDim2.new(0,0,0.14,0)
scrollFrame.Size = UDim2.new(1,0,0.86,0)
scrollFrame.ScrollBarThickness = 0

local panelTitle = Instance.new("TextLabel",topBar)
panelTitle.AnchorPoint = Vector2.new(0,0.5)
panelTitle.BackgroundTransparency = 1
panelTitle.Position = UDim2.new(0.02,0,0.5,0)
panelTitle.Size = UDim2.new(1,0,0.5,0)
panelTitle.Text = '<b>Paint Admin Panel</b><font size="6"> PRO</font>'
panelTitle.RichText = true
panelTitle.TextScaled = true
panelTitle.TextColor3 = Color3.fromRGB(255,255,255)
panelTitle.TextXAlignment = Enum.TextXAlignment.Left

-- Buttons
local function createNewOption(optionType,text,customText,enabled)
	local optionFrame = Instance.new("Frame",scrollFrame)
	optionFrame.BorderColor3 = Color3.fromRGB(0,0,0)
	optionFrame.BackgroundColor3 = Color3.fromRGB(49, 49, 64)
	optionFrame.Size = UDim2.new(1,0,0.075,0)

	local textlabel = Instance.new("TextLabel",optionFrame)
	textlabel.BackgroundTransparency = 1
	textlabel.Position = UDim2.new(0.02,0,0.2,0)
	textlabel.Size = UDim2.new(1,0,0.6,0)
	textlabel.TextScaled = true
	textlabel.Text = text
	textlabel.Font = Enum.Font.SourceSansBold
	textlabel.TextColor3 = Color3.fromRGB(255,255,255)
	textlabel.TextXAlignment = Enum.TextXAlignment.Left

	if optionType == "custom" then
		local button = Instance.new("ImageButton",optionFrame)
		button.BackgroundColor3 = Color3.fromRGB(100,100,100)
		button.Position = UDim2.new(0.865,0,0.125,0)
		button.Size = UDim2.new(0.125,0,0.75,0)
		button.AutoButtonColor = false
		local textlabel = Instance.new("TextLabel",button)
		textlabel.BackgroundTransparency = 1
		textlabel.Position = UDim2.new(0.5,0,0.5,0)
		textlabel.AnchorPoint = Vector2.new(0.5,0.5)
		textlabel.Size = UDim2.new(0.8,0,0.8,0)
		textlabel.Text = customText
		textlabel.TextScaled = true
		textlabel.Font = Enum.Font.SourceSansBold
		textlabel.TextColor3 = Color3.fromRGB(255,255,255)
		return button
	end
end

-- Variables
local provinces = {}
local provincespersecond = 0
local painting = true
local selectProvincesMode = false
local provinceCodeGenerator = 0

local dragging
local dragInput
local dragStart
local startPos

-- Paint loop
local function paintProvinceLoop(province,coro,highlighty)
	local savedColor = color
	local active = true
	local eventObject = {}
	function eventObject:Disconnect() active = false end

	task.spawn(function()
		while active do
			if painting and province.Color ~= color then
				local args = {
					[1] = "PaintPart",
					[2] = {["Part"]=province,["Color"]=color},
					[3] = "Peace"
				}
				pcall(function()
					player.Character.PaintBucket.Remotes.ServerControls:InvokeServer(unpack(args))
				end)
				provincespersecond = provincespersecond + 1
			end
			task.wait(0.05)
		end
	end)

	table.insert(provinces,{Province=province,Coroutine=coro,Event=eventObject,Highlight=highlighty})
	provinceCodeGenerator += 1
end

-- Add button (drag select)
local button1 = createNewOption("custom","Protect Province","Add")
local doneButton = Instance.new("TextButton",UI)
doneButton.Visible = false
doneButton.Text = "Done"

button1.MouseButton1Down:Connect(function()
	UIHolder.Visible = false
	selectProvincesMode = true
	doneButton.Visible = true
	local selectedProvinces = {}
	local connection

	connection = userInputService.InputChanged:Connect(function(input)
		if selectProvincesMode then
			if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
				local target = mouse.Target
				if target and target.Name == "Province" and not table.find(selectedProvinces,target) then
					table.insert(selectedProvinces,target)
					local clone = target:Clone()
					local coro = coroutine.create(paintProvinceLoop)
					coroutine.resume(coro,target,coro,clone)
					clone.Position -= Vector3.new(0,0.01,0)
					clone.Material = "Glass"
					clone.Transparency = 1000000
					clone.Parent = provincesFolder
				end
			end
		end
	end)

	doneButton.MouseButton1Down:Connect(function()
		selectProvincesMode = false
		UIHolder.Visible = true
		doneButton.Visible = false
		if connection then connection:Disconnect() end
	end)
end)
